{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///E:/pharmacy-system-v2/frontend/context/AuthContext.js"],"sourcesContent":["// context/AuthContext.js\r\nimport { createContext, useContext, useEffect, useState } from \"react\";\r\n\r\nconst AuthContext = createContext();\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // تحميل المستخدم من LocalStorage\r\n  useEffect(() => {\r\n    const saved = localStorage.getItem(\"pharmacy_user\");\r\n    if (saved) {\r\n      try {\r\n        setUser(JSON.parse(saved));\r\n      } catch {\r\n        localStorage.removeItem(\"pharmacy_user\");\r\n      }\r\n    }\r\n    setLoading(false);\r\n  }, []);\r\n\r\n  // نظام تسجيل الدخول التجريبي\r\n  const loginDemo = (username) => {\r\n    const DEMO = {\r\n      admin: {\r\n        username: \"admin\",\r\n        role: \"admin\",\r\n        name: \"مدير النظام\",\r\n        permissions: [\"view_dashboard\"]\r\n      },\r\n      ph: {\r\n        username: \"ph\",\r\n        role: \"pharmacist\",\r\n        name: \"الصيدلي\",\r\n        permissions: [\"view_dashboard\"]\r\n      },\r\n      ca: {\r\n        username: \"ca\",\r\n        role: \"cashier\",\r\n        name: \"الكاشير\",\r\n        permissions: [\"view_dashboard\"]\r\n      }\r\n    };\r\n\r\n    const found = DEMO[username];\r\n    if (!found) return false;\r\n\r\n    setUser(found);\r\n    localStorage.setItem(\"pharmacy_user\", JSON.stringify(found));\r\n    return true;\r\n  };\r\n\r\n  const hasPermission = (perm) => {\r\n    if (!user || !user.permissions) return false;\r\n    return user.permissions.includes(perm);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        loading,\r\n        loginDemo,\r\n        hasPermission,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// // context/AuthContext.js\r\n// import { createContext, useContext, useState } from \"react\";\r\n\r\n// const AuthContext = createContext();\r\n\r\n// export function AuthProvider({ children }) {\r\n//   // مستخدم افتراضي (يمكن تعديله لاحقًا من شاشة الدخول)\r\n//   const [user, setUser] = useState({\r\n//     name: \"المدير أحمد\",\r\n//     role: \"admin\", // admin | cashier | pharmacist\r\n//   });\r\n\r\n//   // التحقق من الصلاحيات\r\n//   const hasPermission = (roles) => roles.includes(user.role);\r\n\r\n//   return (\r\n//     <AuthContext.Provider value={{ user, setUser, hasPermission }}>\r\n//       {children}\r\n//     </AuthContext.Provider>\r\n//   );\r\n// }\r\n\r\n// export function useAuth() {\r\n//   return useContext(AuthContext);\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// import { createContext, useContext, useState } from \"react\";\r\n\r\n// const AuthContext = createContext();\r\n\r\n// export function AuthProvider({ children }) {\r\n//   const [user, setUser] = useState({\r\n//     name: \"المدير أحمد\",\r\n//     role: \"admin\", // admin | cashier | pharmacist\r\n//   });\r\n\r\n//   const hasPermission = (roles) => {\r\n//     return roles.includes(user.role);\r\n//   };\r\n\r\n//   return (\r\n//     <AuthContext.Provider value={{ user, setUser, hasPermission }}>\r\n//       {children}\r\n//     </AuthContext.Provider>\r\n//   );\r\n// }\r\n\r\n// export const useAuth = () => useContext(AuthContext);\r\n"],"names":[],"mappings":"AAAA,yBAAyB;;;;;;;;AACzB;;;AAEA,MAAM,4BAAc,IAAA,oHAAa;AAC1B,MAAM,UAAU,IAAM,IAAA,iHAAU,EAAC;AAEjC,SAAS,aAAa,EAAE,QAAQ,EAAE;IACvC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,+GAAQ,EAAC;IACjC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+GAAQ,EAAC;IAEvC,iCAAiC;IACjC,IAAA,gHAAS,EAAC;QACR,MAAM,QAAQ,aAAa,OAAO,CAAC;QACnC,IAAI,OAAO;YACT,IAAI;gBACF,QAAQ,KAAK,KAAK,CAAC;YACrB,EAAE,OAAM;gBACN,aAAa,UAAU,CAAC;YAC1B;QACF;QACA,WAAW;IACb,GAAG,EAAE;IAEL,6BAA6B;IAC7B,MAAM,YAAY,CAAC;QACjB,MAAM,OAAO;YACX,OAAO;gBACL,UAAU;gBACV,MAAM;gBACN,MAAM;gBACN,aAAa;oBAAC;iBAAiB;YACjC;YACA,IAAI;gBACF,UAAU;gBACV,MAAM;gBACN,MAAM;gBACN,aAAa;oBAAC;iBAAiB;YACjC;YACA,IAAI;gBACF,UAAU;gBACV,MAAM;gBACN,MAAM;gBACN,aAAa;oBAAC;iBAAiB;YACjC;QACF;QAEA,MAAM,QAAQ,IAAI,CAAC,SAAS;QAC5B,IAAI,CAAC,OAAO,OAAO;QAEnB,QAAQ;QACR,aAAa,OAAO,CAAC,iBAAiB,KAAK,SAAS,CAAC;QACrD,OAAO;IACT;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,CAAC,QAAQ,CAAC,KAAK,WAAW,EAAE,OAAO;QACvC,OAAO,KAAK,WAAW,CAAC,QAAQ,CAAC;IACnC;IAEA,qBACE,qKAAC,YAAY,QAAQ;QACnB,OAAO;YACL;YACA;YACA;YACA;QACF;kBAEC;;;;;;AAGP,EAgBA,4BAA4B;CAC5B,+DAA+D;CAE/D,uCAAuC;CAEvC,+CAA+C;CAC/C,0DAA0D;CAC1D,uCAAuC;CACvC,2BAA2B;CAC3B,qDAAqD;CACrD,QAAQ;CAER,2BAA2B;CAC3B,gEAAgE;CAEhE,aAAa;CACb,sEAAsE;CACtE,mBAAmB;CACnB,8BAA8B;CAC9B,OAAO;CACP,IAAI;CAEJ,8BAA8B;CAC9B,oCAAoC;CACpC,IAAI;CAWJ,+DAA+D;CAE/D,uCAAuC;CAEvC,+CAA+C;CAC/C,uCAAuC;CACvC,2BAA2B;CAC3B,qDAAqD;CACrD,QAAQ;CAER,uCAAuC;CACvC,wCAAwC;CACxC,OAAO;CAEP,aAAa;CACb,sEAAsE;CACtE,mBAAmB;CACnB,8BAA8B;CAC9B,OAAO;CACP,IAAI;CAEJ,wDAAwD","debugId":null}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///E:/pharmacy-system-v2/frontend/pages/_app.js"],"sourcesContent":["// pages/_app.js\r\nimport \"../styles/globals.css\";\r\nimport { useRouter } from \"next/router\";\r\nimport { useEffect } from \"react\";\r\nimport { AuthProvider, useAuth } from \"../context/AuthContext\";\r\nimport { Toaster } from \"react-hot-toast\";\r\n\r\n// لو عندك Providers أخرى (InventoryContext, ShiftContext, ...)\r\n// لفها داخل AuthProvider\r\n\r\nfunction GuardedApp({ Component, pageProps }) {\r\n  const router = useRouter();\r\n  const { user, loading, canAccessRoute } = useAuth();\r\n\r\n  useEffect(() => {\r\n    if (loading) return;\r\n\r\n    const path = router.pathname;\r\n\r\n    // صفحات عامة\r\n    const publicRoutes = [\"/\", \"/403\"];\r\n    if (publicRoutes.includes(path)) return;\r\n\r\n    // لو ما في مستخدم → يرجع للّوغين\r\n    if (!user) {\r\n      router.replace(\"/\");\r\n      return;\r\n    }\r\n\r\n    // لو ما عنده صلاحية على الصفحة → 403\r\n    if (!canAccessRoute(path)) {\r\n      router.replace(\"/403\");\r\n    }\r\n  }, [router, user, loading, canAccessRoute]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div dir=\"rtl\" className=\"flex items-center justify-center h-screen\">\r\n        <p className=\"text-sm text-gray-500\">جارٍ تحميل الجلسة...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return <Component {...pageProps} />;\r\n}\r\n\r\nexport default function MyApp(props) {\r\n  return (\r\n    <AuthProvider>\r\n      <Toaster position=\"top-center\" />\r\n      <GuardedApp {...props} />\r\n    </AuthProvider>\r\n  );\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// // pages/_app.js\r\n// import \"../styles/globals.css\";\r\n// import { Toaster } from \"react-hot-toast\";\r\n// import { AuthProvider } from \"../context/AuthContext\";\r\n// import { InventoryProvider } from \"../context/InventoryContext\";\r\n// import { ShiftProvider } from \"../context/ShiftContext\";\r\n\r\n// export default function MyApp({ Component, pageProps }) {\r\n//   return (\r\n//     <AuthProvider>\r\n//       <InventoryProvider>\r\n//         <ShiftProvider>\r\n//           <>\r\n//             <Toaster position=\"top-center\" />\r\n//             <Component {...pageProps} />\r\n//           </>\r\n//         </ShiftProvider>\r\n//       </InventoryProvider>\r\n//     </AuthProvider>\r\n//   );\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// // pages/_app.js\r\n// import \"../styles/globals.css\";\r\n// import { useRouter } from \"next/router\";\r\n// import AuthGuard from \"../components/AuthGuard\";\r\n// import { InventoryProvider } from \"../context/InventoryContext\";\r\n\r\n// export default function MyApp({ Component, pageProps }) {\r\n//   const router = useRouter();\r\n\r\n//   const publicRoutes = [\"/\"]; // صفحة تسجيل الدخول مثلاً\r\n//   const isPublic = publicRoutes.includes(router.pathname);\r\n\r\n//   if (isPublic) {\r\n//     return (\r\n//       <InventoryProvider>\r\n//         <Component {...pageProps} />\r\n//       </InventoryProvider>\r\n//     );\r\n//   }\r\n\r\n//   return (\r\n//     <InventoryProvider>\r\n//       <AuthGuard>\r\n//         <Component {...pageProps} />\r\n//       </AuthGuard>\r\n//     </InventoryProvider>\r\n//   );\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// import '../styles/globals.css'\r\n// import { useRouter } from 'next/router'\r\n// import AuthGuard from '../components/AuthGuard'\r\n\r\n// export default function MyApp({ Component, pageProps }) {\r\n//   const router = useRouter()\r\n\r\n//   // المسارات العامة\r\n//   const publicRoutes = ['/']\r\n\r\n//   const isPublic = publicRoutes.includes(router.pathname)\r\n\r\n//   if (isPublic) {\r\n//     return <Component {...pageProps} />\r\n//   }\r\n\r\n//   return (\r\n//     <AuthGuard>\r\n//       <Component {...pageProps} />\r\n//     </AuthGuard>\r\n//   )\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n// // pages/_app.js\r\n// import '../styles/globals.css'\r\n// import { useRouter } from 'next/router'\r\n// import AuthGuard from '../components/AuthGuard'\r\n\r\n// export default function MyApp({ Component, pageProps }) {\r\n//   const router = useRouter()\r\n\r\n//   // المسارات المسموح الوصول لها بدون تسجيل دخول\r\n//   const publicRoutes = ['/']\r\n\r\n//   const isPublic = publicRoutes.includes(router.pathname)\r\n\r\n//   if (isPublic) {\r\n//     return <Component {...pageProps} />\r\n//   }\r\n\r\n//   return (\r\n//     <AuthGuard>\r\n//       <Component {...pageProps} />\r\n//     </AuthGuard>\r\n//   )\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// // pages/_app.js\r\n// import '../styles/globals.css'\r\n\r\n// import { Toaster } from 'react-hot-toast'\r\n\r\n// export default function MyApp({ Component, pageProps }) {\r\n//   return (\r\n//     <>\r\n//       {/* ✅ مكوّن التوستر العام */}\r\n//       <Toaster\r\n//         position=\"top-left\"\r\n//         toastOptions={{\r\n//           duration: 3000,\r\n//           style: { fontFamily: 'Tajawal, sans-serif', direction: 'rtl' },\r\n//           success: {\r\n//             iconTheme: {\r\n//               primary: '#10B981',\r\n//               secondary: 'white',\r\n//             },\r\n//           },\r\n//           error: {\r\n//             iconTheme: {\r\n//               primary: '#EF4444',\r\n//               secondary: 'white',\r\n//             },\r\n//           },\r\n//         }}\r\n//       />\r\n//       <Component {...pageProps} />\r\n//     </>\r\n//   )\r\n// }\r\n\r\n\r\n\r\n\r\n// // pages/_app.js\r\n// import '../styles/globals.css' // استيراد تنسيقات Tailwind\r\n// import { Tajawal } from 'next/font/google'\r\n\r\n// // تحميل الخط من Google\r\n// const tajawal = Tajawal({\r\n//   subsets: ['arabic'],\r\n//   weight: ['400', '500', '700']\r\n// })\r\n\r\n// export default function MyApp({ Component, pageProps }) {\r\n//   return (\r\n//     <div className={tajawal.className}>\r\n//       <Component {...pageProps} />\r\n//     </div>\r\n//   )\r\n// }\r\n"],"names":[],"mappings":"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","debugId":null}}]
}